
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kalman filtering and optimal estimation library">
      
      
        <meta name="author" content="Roger Labbe">
      
      
        <link rel="canonical" href="https://georgepearse.github.io/bayesian_filters/filters/unscented-kalman-filter/">
      
      
        <link rel="prev" href="../extended-kalman-filter/">
      
      
        <link rel="next" href="../ensemble-kalman-filter/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Unscented Kalman Filter - Bayesian Filters</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unscentedkalmanfilter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Bayesian Filters" class="md-header__button md-logo" aria-label="Bayesian Filters" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bayesian Filters
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unscented Kalman Filter
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/GeorgePearse/bayesian_filters" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GeorgePearse/bayesian_filters
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../kalman-filter/" class="md-tabs__link">
          
  
  
  Filters

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../algorithms/gh-filter/" class="md-tabs__link">
          
  
  
  Other Algorithms

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/kalman/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        
  
  
    
  
  Examples

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Bayesian Filters" class="md-nav__button md-logo" aria-label="Bayesian Filters" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Bayesian Filters
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GeorgePearse/bayesian_filters" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GeorgePearse/bayesian_filters
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Filters
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Filters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kalman-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kalman Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extended-kalman-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extended Kalman Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Unscented Kalman Filter
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Unscented Kalman Filter
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unscentedkalmanfilter" class="md-nav__link">
    <span class="md-ellipsis">
      UnscentedKalmanFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnscentedKalmanFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-and-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction and Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unscentedkalmanfilter_1" class="md-nav__link">
    <span class="md-ellipsis">
      UnscentedKalmanFilter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter" class="md-nav__link">
    <span class="md-ellipsis">
      UnscentedKalmanFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnscentedKalmanFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.likelihood" class="md-nav__link">
    <span class="md-ellipsis">
      likelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.log_likelihood" class="md-nav__link">
    <span class="md-ellipsis">
      log_likelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.mahalanobis" class="md-nav__link">
    <span class="md-ellipsis">
      mahalanobis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.batch_filter" class="md-nav__link">
    <span class="md-ellipsis">
      batch_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.compute_process_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      compute_process_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.cross_variance" class="md-nav__link">
    <span class="md-ellipsis">
      cross_variance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.rts_smoother" class="md-nav__link">
    <span class="md-ellipsis">
      rts_smoother
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merwe-scaled-sigma-points" class="md-nav__link">
    <span class="md-ellipsis">
      Merwe Scaled Sigma Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints" class="md-nav__link">
    <span class="md-ellipsis">
      MerweScaledSigmaPoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MerweScaledSigmaPoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.num_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      num_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.sigma_points" class="md-nav__link">
    <span class="md-ellipsis">
      sigma_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#julier-sigma-points" class="md-nav__link">
    <span class="md-ellipsis">
      Julier Sigma Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints" class="md-nav__link">
    <span class="md-ellipsis">
      JulierSigmaPoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JulierSigmaPoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints.num_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      num_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints.sigma_points" class="md-nav__link">
    <span class="md-ellipsis">
      sigma_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simplex-sigma-points" class="md-nav__link">
    <span class="md-ellipsis">
      Simplex Sigma Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints" class="md-nav__link">
    <span class="md-ellipsis">
      SimplexSigmaPoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimplexSigmaPoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.num_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      num_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.sigma_points" class="md-nav__link">
    <span class="md-ellipsis">
      sigma_points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ensemble-kalman-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ensemble Kalman Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../information-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Information Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../square-root-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Square Root Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fading-kalman-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fading Kalman Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../h-infinity-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    H-Infinity Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imm-estimator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IMM Estimator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mmae-filter-bank/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MMAE Filter Bank
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Other Algorithms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Other Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/gh-filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GH Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/discrete-bayes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Discrete Bayes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/least-squares/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Least Squares
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/monte-carlo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monte Carlo
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/kalman/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kalman
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/gh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GH
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/discrete-bayes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Discrete Bayes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/leastsq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Least Squares
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/monte-carlo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monte Carlo
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unscentedkalmanfilter" class="md-nav__link">
    <span class="md-ellipsis">
      UnscentedKalmanFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnscentedKalmanFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-and-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction and Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unscentedkalmanfilter_1" class="md-nav__link">
    <span class="md-ellipsis">
      UnscentedKalmanFilter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter" class="md-nav__link">
    <span class="md-ellipsis">
      UnscentedKalmanFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UnscentedKalmanFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.likelihood" class="md-nav__link">
    <span class="md-ellipsis">
      likelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.log_likelihood" class="md-nav__link">
    <span class="md-ellipsis">
      log_likelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.mahalanobis" class="md-nav__link">
    <span class="md-ellipsis">
      mahalanobis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.batch_filter" class="md-nav__link">
    <span class="md-ellipsis">
      batch_filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.compute_process_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      compute_process_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.cross_variance" class="md-nav__link">
    <span class="md-ellipsis">
      cross_variance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.rts_smoother" class="md-nav__link">
    <span class="md-ellipsis">
      rts_smoother
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merwe-scaled-sigma-points" class="md-nav__link">
    <span class="md-ellipsis">
      Merwe Scaled Sigma Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints" class="md-nav__link">
    <span class="md-ellipsis">
      MerweScaledSigmaPoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MerweScaledSigmaPoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.num_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      num_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.sigma_points" class="md-nav__link">
    <span class="md-ellipsis">
      sigma_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#julier-sigma-points" class="md-nav__link">
    <span class="md-ellipsis">
      Julier Sigma Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints" class="md-nav__link">
    <span class="md-ellipsis">
      JulierSigmaPoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JulierSigmaPoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints.num_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      num_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints.sigma_points" class="md-nav__link">
    <span class="md-ellipsis">
      sigma_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simplex-sigma-points" class="md-nav__link">
    <span class="md-ellipsis">
      Simplex Sigma Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints" class="md-nav__link">
    <span class="md-ellipsis">
      SimplexSigmaPoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimplexSigmaPoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.num_sigmas" class="md-nav__link">
    <span class="md-ellipsis">
      num_sigmas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.sigma_points" class="md-nav__link">
    <span class="md-ellipsis">
      sigma_points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Unscented Kalman Filter</h1>

<h2 id="unscentedkalmanfilter">UnscentedKalmanFilter<a class="headerlink" href="#unscentedkalmanfilter" title="Permanent link">&para;</a></h2>
<h3 id="introduction-and-overview">Introduction and Overview<a class="headerlink" href="#introduction-and-overview" title="Permanent link">&para;</a></h3>
<p>This implements the unscented Kalman filter.</p>
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>
<h3 id="unscentedkalmanfilter_1">UnscentedKalmanFilter<a class="headerlink" href="#unscentedkalmanfilter_1" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<h2 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter" class="doc doc-heading">
            <code>UnscentedKalmanFilter</code>


<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Implements the Scaled Unscented Kalman filter (UKF) as defined by
Simon Julier in [1], using the formulation provided by Wan and Merle
in [2]. This filter scales the sigma points to avoid strong nonlinearities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dim_x</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of state variables for the filter. For example, if
you are tracking the position and velocity of an object in two
dimensions, dim_x would be 4.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dim_z</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of of measurement inputs. For example, if the sensor
provides you with position in (x,y), dim_z would be 2.</p>
<p>This is for convience, so everything is sized correctly on
creation. If you are using multiple sensors the size of <code>z</code> can
change based on the sensor. Just provide the appropriate hx function</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hx</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x">x</span>, **<span title="hx_args">hx_args</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Measurement function. Converts state vector x into a measurement
vector of shape (dim_z).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fx</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x">x</span>, <span title="dt">dt</span>, **<span title="fx_args">fx_args</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function that returns the state x transformed by the
state transition function. dt is the time step in seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td>
                  <code>class</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class which computes the sigma points and weights for a UKF
algorithm. You can vary the UKF implementation by changing this
class. For example, MerweScaledSigmaPoints implements the alpha,
beta, kappa parameterization of Van der Merwe, and
JulierSigmaPoints implements Julier's original kappa
parameterization. See either of those for the required
signature of this class if you want to implement your own.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sqrt_fn</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="ndarray">ndarray</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines how we compute the square root of a matrix, which has
no unique answer. Cholesky is the default choice due to its
speed. Typically your alternative choice will be
scipy.linalg.sqrtm. Different choices affect how the sigma points
are arranged relative to the eigenvectors of the covariance matrix.
Usually this will not matter to you; if so the default cholesky()
yields maximal performance. As of van der Merwe's dissertation of
2004 [6] this was not a well reseached area so I have no advice
to give you.</p>
<p>If your method returns a triangular matrix it must be upper
triangular. Do not use numpy.linalg.cholesky - for historical
reasons it returns a lower triangular matrix. The SciPy version
does the right thing as far as this class is concerned.</p>
              </div>
            </td>
            <td>
                  <code>None (implies scipy.linalg.cholesky)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_mean_fn</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="bayesian_filters.kalman.sigma_points">sigma_points</span>, <span title="weights">weights</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that computes the mean of the provided sigma points
and weights. Use this if your state variable contains nonlinear
values such as angles which cannot be summed.</p>
<p>.. code-block:: Python</p>
<div class="highlight"><pre><span></span><code>def state_mean(sigmas, Wm):
    x = np.zeros(3)
    sum_sin, sum_cos = 0., 0.

    for i in range(len(sigmas)):
        s = sigmas[i]
        x[0] += s[0] * Wm[i]
        x[1] += s[1] * Wm[i]
        sum_sin += sin(s[2])*Wm[i]
        sum_cos += cos(s[2])*Wm[i]
    x[2] = atan2(sum_sin, sum_cos)
    return x
</code></pre></div>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z_mean_fn</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="bayesian_filters.kalman.sigma_points">sigma_points</span>, <span title="weights">weights</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Same as x_mean_fn, except it is called for sigma points which
form the measurements after being passed through hx().</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>residual_x</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x">x</span>, <span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.y">y</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>residual_z</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x">x</span>, <span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.y">y</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that computes the residual (difference) between x and y.
You will have to supply this if your state variable cannot support
subtraction, such as angles (359-1 degreees is 2, not 358). x and y
are state vectors, not scalars. One is for the state variable,
the other is for the measurement state.</p>
<p>.. code-block:: Python</p>
<div class="highlight"><pre><span></span><code>def residual(a, b):
    y = a[0] - b[0]
    if y &gt; np.pi:
        y -= 2*np.pi
    if y &lt; -np.pi:
        y += 2*np.pi
    return y
</code></pre></div>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state_add</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that subtracts two state vectors, returning a new
state vector. Used during update to compute <code>x + K@y</code>
You will have to supply this if your state variable does not
suport addition, such as it contains angles.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x">x</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>state estimate vector</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.P">P</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>, <span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>covariance estimate matrix</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x_prior">x_prior</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prior (predicted) state estimate. The <em>_prior and </em>_post attributes
are for convienence; they store the  prior and posterior of the
current epoch. Read Only.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.P_prior">P_prior</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>, <span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prior (predicted) state covariance matrix. Read Only.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.x_post">x_post</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Posterior (updated) state estimate. Read Only.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.P_post">P_post</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>, <span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Posterior (updated) state covariance matrix. Read Only.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.z">z</span></code></td>
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last measurement used in update(). Read only.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.R">R</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_z">dim_z</span>, <span title="dim_z">dim_z</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>measurement noise matrix</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.Q">Q</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span>(<span title="dim_x">dim_x</span>, <span title="dim_x">dim_x</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>process noise matrix</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.K">K</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kalman gain</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.y">y</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>innovation residual</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="log_likelihood

  
      property
   (bayesian_filters.kalman.UKF.UnscentedKalmanFilter.log_likelihood)" href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.log_likelihood">log_likelihood</a></code></td>
            <td>
                  <code><span title="scalar">scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Log likelihood of last measurement update.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="likelihood

  
      property
   (bayesian_filters.kalman.UKF.UnscentedKalmanFilter.likelihood)" href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.likelihood">likelihood</a></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>likelihood of last measurment. Read only.</p>
<p>Computed from the log-likelihood. The log-likelihood can be very
small,  meaning a large negative value such as -28000. Taking the
exp() of that results in 0.0, which can break typical algorithms
which multiply by this value, so by default we always return a
number &gt;= sys.float_info.min.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="mahalanobis

  
      property
   (bayesian_filters.kalman.UKF.UnscentedKalmanFilter.mahalanobis)" href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.mahalanobis">mahalanobis</a></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mahalanobis distance of the measurement. Read only.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.inv">inv</span></code></td>
            <td>
                  <code>function, default numpy.linalg.inv</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If you prefer another inverse function, such as the Moore-Penrose
pseudo inverse, set it to that instead:</p>
<p>.. code-block:: Python</p>
<div class="highlight"><pre><span></span><code>kf.inv = np.linalg.pinv
</code></pre></div>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Simple example of a linear order 1 kinematic filter in 2D. There is no
need to use a UKF for this example, but it is easy to read.</p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">fx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># state transition function - predict next state based</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># on constant velocity model x = vt + x_0</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dt</span><span class="p">],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span>                  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">hx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">&gt;&gt;&gt; </span>   <span class="c1"># measurement function - convert state into a measurement</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">&gt;&gt;&gt; </span>   <span class="c1"># where measurements are [x_pos, y_pos]</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="gp">&gt;&gt;&gt; </span>   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># create sigma points to use in the filter. This is standard for Gaussian processes</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">points</span> <span class="o">=</span> <span class="n">MerweScaledSigmaPoints</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">kf</span> <span class="o">=</span> <span class="n">UnscentedKalmanFilter</span><span class="p">(</span><span class="n">dim_x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dim_z</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="n">fx</span><span class="p">,</span> <span class="n">hx</span><span class="o">=</span><span class="n">hx</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">kf</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># initial state</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">kf</span><span class="o">.</span><span class="n">P</span> <span class="o">*=</span> <span class="mf">0.2</span> <span class="c1"># initial uncertainty</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">z_std</span> <span class="o">=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">kf</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">z_std</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">z_std</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 1 standard</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">kf</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q_discrete_white_noise</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.01</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">zs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="o">+</span><span class="n">randn</span><span class="p">()</span><span class="o">*</span><span class="n">z_std</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">randn</span><span class="p">()</span><span class="o">*</span><span class="n">z_std</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]</span> <span class="c1"># measurements</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zs</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="n">kf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="n">kf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="nb">print</span><span class="p">(</span><span class="n">kf</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;log-likelihood&#39;</span><span class="p">,</span> <span class="n">kf</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">)</span>
</code></pre></div>
    <p>For in depth explanations see my book Kalman and Bayesian Filters in Python
https://github.com/rlabbe/Kalman-and-Bayesian-Filters-in-Python</p>
<p>Also see the bayesian_filters/kalman/tests subdirectory for test code that
may be illuminating.</p>


<details class="references" open>
  <summary>References</summary>
  <p>.. [1] Julier, Simon J. "The scaled unscented transformation,"
    American Control Converence, 2002, pp 4555-4559, vol 6.</p>
<div class="highlight"><pre><span></span><code>Online copy:
https://www.cs.unc.edu/~welch/kalman/media/pdf/ACC02-IEEE1357.PDF
</code></pre></div>
<p>.. [2] E. A. Wan and R. Van der Merwe, The unscented Kalman filter for
    nonlinear estimation, in Proc. Symp. Adaptive Syst. Signal
    Process., Commun. Contr., Lake Louise, AB, Canada, Oct. 2000.</p>
<div class="highlight"><pre><span></span><code>Online Copy:
https://www.seas.harvard.edu/courses/cs281/papers/unscented.pdf
</code></pre></div>
<p>.. [3] S. Julier, J. Uhlmann, and H. Durrant-Whyte. "A new method for
       the nonlinear transformation of means and covariances in filters
       and estimators," IEEE Transactions on Automatic Control, 45(3),
       pp. 477-482 (March 2000).</p>
<p>.. [4] E. A. Wan and R. Van der Merwe, The Unscented Kalman filter for
       Nonlinear Estimation, in Proc. Symp. Adaptive Syst. Signal
       Process., Commun. Contr., Lake Louise, AB, Canada, Oct. 2000.</p>
<div class="highlight"><pre><span></span><code>   https://www.seas.harvard.edu/courses/cs281/papers/unscented.pdf
</code></pre></div>
<p>.. [5] Wan, Merle "The Unscented Kalman Filter," chapter in <em>Kalman
       Filtering and Neural Networks</em>, John Wiley &amp; Sons, Inc., 2001.</p>
<p>.. [6] R. Van der Merwe "Sigma-Point Kalman Filters for Probabilitic
       Inference in Dynamic State-Space Models" (Doctoral dissertation)</p>
</details>







              <details class="quote">
                <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="k">class</span><span class="w"> </span><span class="nc">UnscentedKalmanFilter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="c1"># pylint: disable=too-many-instance-attributes</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="c1"># pylint: disable=invalid-name</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Implements the Scaled Unscented Kalman filter (UKF) as defined by</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Simon Julier in [1], using the formulation provided by Wan and Merle</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    in [2]. This filter scales the sigma points to avoid strong nonlinearities.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    dim_x : int</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        Number of state variables for the filter. For example, if</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        you are tracking the position and velocity of an object in two</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        dimensions, dim_x would be 4.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    dim_z : int</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        Number of of measurement inputs. For example, if the sensor</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        provides you with position in (x,y), dim_z would be 2.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        This is for convience, so everything is sized correctly on</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        creation. If you are using multiple sensors the size of `z` can</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        change based on the sensor. Just provide the appropriate hx function</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    hx : function(x,**hx_args)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Measurement function. Converts state vector x into a measurement</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        vector of shape (dim_z).</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    fx : function(x,dt,**fx_args)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        function that returns the state x transformed by the</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        state transition function. dt is the time step in seconds.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    points : class</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Class which computes the sigma points and weights for a UKF</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        algorithm. You can vary the UKF implementation by changing this</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        class. For example, MerweScaledSigmaPoints implements the alpha,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        beta, kappa parameterization of Van der Merwe, and</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        JulierSigmaPoints implements Julier&#39;s original kappa</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        parameterization. See either of those for the required</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        signature of this class if you want to implement your own.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    sqrt_fn : callable(ndarray), default=None (implies scipy.linalg.cholesky)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        Defines how we compute the square root of a matrix, which has</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        no unique answer. Cholesky is the default choice due to its</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        speed. Typically your alternative choice will be</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        scipy.linalg.sqrtm. Different choices affect how the sigma points</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        are arranged relative to the eigenvectors of the covariance matrix.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Usually this will not matter to you; if so the default cholesky()</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        yields maximal performance. As of van der Merwe&#39;s dissertation of</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        2004 [6] this was not a well reseached area so I have no advice</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        to give you.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        If your method returns a triangular matrix it must be upper</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        triangular. Do not use numpy.linalg.cholesky - for historical</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        reasons it returns a lower triangular matrix. The SciPy version</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        does the right thing as far as this class is concerned.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    x_mean_fn : callable  (sigma_points, weights), optional</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        Function that computes the mean of the provided sigma points</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        and weights. Use this if your state variable contains nonlinear</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        values such as angles which cannot be summed.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        .. code-block:: Python</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            def state_mean(sigmas, Wm):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">                x = np.zeros(3)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                sum_sin, sum_cos = 0., 0.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">                for i in range(len(sigmas)):</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">                    s = sigmas[i]</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">                    x[0] += s[0] * Wm[i]</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">                    x[1] += s[1] * Wm[i]</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">                    sum_sin += sin(s[2])*Wm[i]</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">                    sum_cos += cos(s[2])*Wm[i]</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                x[2] = atan2(sum_sin, sum_cos)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                return x</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    z_mean_fn : callable  (sigma_points, weights), optional</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        Same as x_mean_fn, except it is called for sigma points which</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        form the measurements after being passed through hx().</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    residual_x : callable (x, y), optional</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    residual_z : callable (x, y), optional</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Function that computes the residual (difference) between x and y.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        You will have to supply this if your state variable cannot support</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        subtraction, such as angles (359-1 degreees is 2, not 358). x and y</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        are state vectors, not scalars. One is for the state variable,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        the other is for the measurement state.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        .. code-block:: Python</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">            def residual(a, b):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">                y = a[0] - b[0]</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">                if y &gt; np.pi:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">                    y -= 2*np.pi</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">                if y &lt; -np.pi:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">                    y += 2*np.pi</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">                return y</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    state_add: callable (x, y), optional, default np.add</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Function that subtracts two state vectors, returning a new</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        state vector. Used during update to compute `x + K@y`</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        You will have to supply this if your state variable does not</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        suport addition, such as it contains angles.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    x : numpy.array(dim_x)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        state estimate vector</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    P : numpy.array(dim_x, dim_x)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        covariance estimate matrix</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    x_prior : numpy.array(dim_x)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Prior (predicted) state estimate. The *_prior and *_post attributes</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        are for convienence; they store the  prior and posterior of the</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        current epoch. Read Only.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    P_prior : numpy.array(dim_x, dim_x)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Prior (predicted) state covariance matrix. Read Only.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    x_post : numpy.array(dim_x)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        Posterior (updated) state estimate. Read Only.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    P_post : numpy.array(dim_x, dim_x)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        Posterior (updated) state covariance matrix. Read Only.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    z : ndarray</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        Last measurement used in update(). Read only.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    R : numpy.array(dim_z, dim_z)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        measurement noise matrix</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Q : numpy.array(dim_x, dim_x)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        process noise matrix</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    K : numpy.array</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        Kalman gain</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    y : numpy.array</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        innovation residual</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    log_likelihood : scalar</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        Log likelihood of last measurement update.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    likelihood : float</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        likelihood of last measurment. Read only.</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        Computed from the log-likelihood. The log-likelihood can be very</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        small,  meaning a large negative value such as -28000. Taking the</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        exp() of that results in 0.0, which can break typical algorithms</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        which multiply by this value, so by default we always return a</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        number &gt;= sys.float_info.min.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    mahalanobis : float</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        mahalanobis distance of the measurement. Read only.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    inv : function, default numpy.linalg.inv</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        If you prefer another inverse function, such as the Moore-Penrose</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        pseudo inverse, set it to that instead:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        .. code-block:: Python</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">            kf.inv = np.linalg.pinv</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    --------</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    Simple example of a linear order 1 kinematic filter in 2D. There is no</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    need to use a UKF for this example, but it is easy to read.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    &gt;&gt;&gt; def fx(x, dt):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    &gt;&gt;&gt;     # state transition function - predict next state based</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    &gt;&gt;&gt;     # on constant velocity model x = vt + x_0</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    &gt;&gt;&gt;     F = np.array([[1, dt, 0, 0],</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    &gt;&gt;&gt;                   [0, 1, 0, 0],</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    &gt;&gt;&gt;                   [0, 0, 1, dt],</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    &gt;&gt;&gt;                   [0, 0, 0, 1]], dtype=float)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    &gt;&gt;&gt;     return np.dot(F, x)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    &gt;&gt;&gt;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    &gt;&gt;&gt; def hx(x):</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    &gt;&gt;&gt;    # measurement function - convert state into a measurement</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    &gt;&gt;&gt;    # where measurements are [x_pos, y_pos]</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    &gt;&gt;&gt;    return np.array([x[0], x[2]])</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    &gt;&gt;&gt;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    &gt;&gt;&gt; dt = 0.1</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    &gt;&gt;&gt; # create sigma points to use in the filter. This is standard for Gaussian processes</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    &gt;&gt;&gt; points = MerweScaledSigmaPoints(4, alpha=.1, beta=2., kappa=-1)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    &gt;&gt;&gt;</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    &gt;&gt;&gt; kf = UnscentedKalmanFilter(dim_x=4, dim_z=2, dt=dt, fx=fx, hx=hx, points=points)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    &gt;&gt;&gt; kf.x = np.array([-1., 1., -1., 1]) # initial state</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &gt;&gt;&gt; kf.P *= 0.2 # initial uncertainty</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    &gt;&gt;&gt; z_std = 0.1</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    &gt;&gt;&gt; kf.R = np.diag([z_std**2, z_std**2]) # 1 standard</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    &gt;&gt;&gt; kf.Q = Q_discrete_white_noise(dim=2, dt=dt, var=0.01**2, block_size=2)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    &gt;&gt;&gt;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    &gt;&gt;&gt; zs = [[i+randn()*z_std, i+randn()*z_std] for i in range(50)] # measurements</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    &gt;&gt;&gt; for z in zs:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    &gt;&gt;&gt;     kf.predict()</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    &gt;&gt;&gt;     kf.update(z)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    &gt;&gt;&gt;     print(kf.x, &#39;log-likelihood&#39;, kf.log_likelihood)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    For in depth explanations see my book Kalman and Bayesian Filters in Python</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    https://github.com/rlabbe/Kalman-and-Bayesian-Filters-in-Python</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    Also see the bayesian_filters/kalman/tests subdirectory for test code that</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    may be illuminating.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">    References</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    .. [1] Julier, Simon J. &quot;The scaled unscented transformation,&quot;</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        American Control Converence, 2002, pp 4555-4559, vol 6.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        Online copy:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        https://www.cs.unc.edu/~welch/kalman/media/pdf/ACC02-IEEE1357.PDF</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    .. [2] E. A. Wan and R. Van der Merwe, The unscented Kalman filter for</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        nonlinear estimation, in Proc. Symp. Adaptive Syst. Signal</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        Process., Commun. Contr., Lake Louise, AB, Canada, Oct. 2000.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        Online Copy:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        https://www.seas.harvard.edu/courses/cs281/papers/unscented.pdf</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    .. [3] S. Julier, J. Uhlmann, and H. Durrant-Whyte. &quot;A new method for</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">           the nonlinear transformation of means and covariances in filters</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">           and estimators,&quot; IEEE Transactions on Automatic Control, 45(3),</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">           pp. 477-482 (March 2000).</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">    .. [4] E. A. Wan and R. Van der Merwe, The Unscented Kalman filter for</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">           Nonlinear Estimation, in Proc. Symp. Adaptive Syst. Signal</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">           Process., Commun. Contr., Lake Louise, AB, Canada, Oct. 2000.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">           https://www.seas.harvard.edu/courses/cs281/papers/unscented.pdf</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    .. [5] Wan, Merle &quot;The Unscented Kalman Filter,&quot; chapter in *Kalman</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">           Filtering and Neural Networks*, John Wiley &amp; Sons, Inc., 2001.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    .. [6] R. Van der Merwe &quot;Sigma-Point Kalman Filters for Probabilitic</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">           Inference in Dynamic State-Space Models&quot; (Doctoral dissertation)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">dim_x</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">dim_z</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">hx</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="n">fx</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">sqrt_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="n">x_mean_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">z_mean_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">residual_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">residual_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">state_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="p">):</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        Create a Kalman filter. You are responsible for setting the</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        various state variables to reasonable values; the defaults below will</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        not give you a functional filter.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="c1"># pylint: disable=too-many-arguments</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">dim_z</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span> <span class="o">=</span> <span class="n">dim_x</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span> <span class="o">=</span> <span class="n">dim_z</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span> <span class="o">=</span> <span class="n">points</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="n">dt</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">num_sigmas</span><span class="p">()</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hx</span> <span class="o">=</span> <span class="n">hx</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span> <span class="o">=</span> <span class="n">x_mean_fn</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z_mean</span> <span class="o">=</span> <span class="n">z_mean_fn</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="c1"># Only computed only if requested via property</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">if</span> <span class="n">sqrt_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msqrt</span> <span class="o">=</span> <span class="n">cholesky</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">msqrt</span> <span class="o">=</span> <span class="n">sqrt_fn</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="c1"># weights for the means and covariances.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="n">points</span><span class="o">.</span><span class="n">Wc</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="k">if</span> <span class="n">residual_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span> <span class="o">=</span> <span class="n">residual_x</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="k">if</span> <span class="n">residual_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span> <span class="o">=</span> <span class="n">residual_z</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="k">if</span> <span class="n">state_add</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">state_add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">state_add</span> <span class="o">=</span> <span class="n">state_add</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="c1"># sigma points transformed through f(x) and h(x)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="c1"># variables for efficiency so we don&#39;t recreate every update</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">))</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">))</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># Kalman gain</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># residual</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># measurement</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_z</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># system uncertainty</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">SI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_z</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># inverse system uncertainty</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="c1"># these will always be a copy of x,P after predict() is called</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="c1"># these will always be a copy of x,P after update() is called</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">):</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        Performs the predict step of the UKF. On return, self.x and</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        self.P contain the predicted state (x) and covariance (P). &#39;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        Important: this MUST be called before update() is called for the first</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        time.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        dt : double, optional</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">            If specified, the time step to be used for this prediction.</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">            self._dt is used if this is not provided.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        fx : callable f(x, dt, **fx_args), optional</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">            State transition function. If not provided, the default</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">            function passed in during construction will be used.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">            Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            of the unscented transform.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        **fx_args : keyword arguments</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">            optional keyword arguments to be passed into f(x).</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="k">if</span> <span class="n">UT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="n">UT</span> <span class="o">=</span> <span class="n">unscented_transform</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="c1"># calculate sigma points for given mean and covariance</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compute_process_sigmas</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="c1"># and pass sigmas through the unscented transform to compute prior</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">UT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="c1"># update sigma points to reflect the new variance of the points</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span><span class="o">.</span><span class="n">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="c1"># save prior</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">hx_args</span><span class="p">):</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        Update the UKF with the given measurements. On return,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        self.x and self.P contain the new mean and covariance of the filter.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">        z : numpy.array of shape (dim_z)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">            measurement vector</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        R : numpy.array((dim_z, dim_z)), optional</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">            Measurement noise. If provided, overrides self.R for</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">            this function call.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">            Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">            points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">            work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">            of the unscented transform.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        hx : callable h(x, **hx_args), optional</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">            Measurement function. If not provided, the default</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">            function passed in during construction will be used.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        **hx_args : keyword argument</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">            arguments to be passed into h(x) after x -&gt; h(x, **hx_args)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">x_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">P_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="k">return</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="k">if</span> <span class="n">hx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="n">hx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hx</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">if</span> <span class="n">UT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">UT</span> <span class="o">=</span> <span class="n">unscented_transform</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="k">elif</span> <span class="n">isscalar</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="c1"># pass prior sigmas through h(x) to get measurement sigmas</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="c1"># the shape of sigmas_h will vary if the shape of z varies, so</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="c1"># recreate each time</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">sigmas_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>            <span class="n">sigmas_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hx</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">hx_args</span><span class="p">))</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">sigmas_h</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="c1"># mean and covariance of prediction passed through unscented transform</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">UT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">SI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="c1"># compute cross variance of the state and the measurements</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">Pxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">Pxz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SI</span><span class="p">)</span>  <span class="c1"># Kalman gain</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">zp</span><span class="p">)</span>  <span class="c1"># residual</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="c1"># update Gaussian state estimate (x, P)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="c1"># save measurement and posterior state</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="c1"># set to None to force recompute</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cross_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sigmas_f</span><span class="p">,</span> <span class="n">sigmas_h</span><span class="p">):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        Compute cross variance of the state `x` and measurement `z`.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">Pxz</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">sigmas_f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigmas_h</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">sigmas_f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">(</span><span class="n">sigmas_h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="n">Pxz</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">outer</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="k">return</span> <span class="n">Pxz</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_process_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">):</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        computes the values of sigmas_f. Normally a user would not call</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        this, but it is useful if you need to call update more than once</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">        between calls to predict (to update for multiple simultaneous</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">        measurements), so the sigmas correctly reflect the updated state</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">        x, P.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="k">if</span> <span class="n">fx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="n">fx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fx</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="c1"># calculate sigma points for given mean and covariance</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="n">sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span><span class="o">.</span><span class="n">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sigmas</span><span class="p">):</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fx</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saver</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        Performs the UKF filter over the list of measurement in `zs`.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        zs : list-like</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">            list of measurements at each time step `self._dt` Missing</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">            measurements must be represented by &#39;None&#39;.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">        Rs : None, np.array or list-like, default=None</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">            optional list of values to use for the measurement error</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">            covariance R.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">            If Rs is None then self.R is used for all epochs.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">            If it is a list of matrices or a 3D array where</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            len(Rs) == len(zs), then it is treated as a list of R values, one</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">            per epoch. This allows you to have varying R per epoch.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        dts : None, scalar or list-like, default=None</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">            optional value or list of delta time to be passed into predict.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">            If dtss is None then self.dt is used for all epochs.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">            If it is a list where len(dts) == len(zs), then it is treated as a</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">            list of dt values, one per epoch. This allows you to have varying</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">            epoch durations.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">            Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">            points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">            work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">            of the unscented transform.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">        saver : bayesian_filters.common.Saver, optional</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">            bayesian_filters.common.Saver object. If provided, saver.save() will be</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">            called after every epoch</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        -------</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        means: ndarray((n,dim_x,1))</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">            array of the state for each time step after the update. Each entry</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">            is an np.array. In other words `means[k,:]` is the state at step</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">            `k`.</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">        covariance: ndarray((n,dim_x,dim_x))</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">            array of the covariances for each time step after the update.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">            In other words `covariance[k,:,:]` is the covariance at step `k`.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        --------</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">        .. code-block:: Python</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">            # this example demonstrates tracking a measurement where the time</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">            # between measurement varies, as stored in dts The output is then smoothed</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">            # with an RTS smoother.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">            zs = [t + random.randn()*4 for t in range (40)]</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            (mu, cov, _, _) = ukf.batch_filter(zs, dts=dts)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">            (xs, Ps, Ks) = ukf.rts_smoother(mu, cov)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="c1"># pylint: disable=too-many-arguments</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">zs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;zs must be list-like&quot;</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">isscalar</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;zs must be a list of scalars or 1D, 1 element arrays&quot;</span><span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;each element in zs must be a 1D array of length </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">))</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="n">z_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="k">if</span> <span class="n">Rs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="n">Rs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_n</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_n</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="c1"># mean estimates from Kalman Filter</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="n">means</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">z_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">))</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="n">means</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">z_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="c1"># state covariances from Kalman Filter</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">covariances</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">z_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">))</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">dts</span><span class="p">)):</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="n">UT</span><span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="n">UT</span><span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>            <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="n">covariances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="k">if</span> <span class="n">saver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">covariances</span><span class="p">)</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rts_smoother</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xs</span><span class="p">,</span> <span class="n">Ps</span><span class="p">,</span> <span class="n">Qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">        Runs the Rauch-Tung-Striebel Kalman smoother on a set of</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">        means and covariances computed by the UKF. The usual input</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        would come from the output of `batch_filter()`.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">        Xs : numpy.array</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">            array of the means (state variable x) of the output of a Kalman</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">            filter.</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        Ps : numpy.array</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">            array of the covariances of the output of a kalman filter.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">        Qs: list-like collection of numpy.array, optional</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">            Process noise of the Kalman filter at each time step. Optional,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">            if not provided the filter&#39;s self.Q will be used</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        dt : optional, float or array-like of float</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">            If provided, specifies the time step of each step of the filter.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">            If float, then the same time step is used for all steps. If</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">            an array, then each element k contains the time  at step k.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">            Units are seconds.</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">            Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">            points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">            work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">            of the unscented transform.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        -------</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        x : numpy.ndarray</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">            smoothed means</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">        P : numpy.ndarray</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">            smoothed state covariances</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">        K : numpy.ndarray</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">            smoother gain at each step</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        Examples</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        --------</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        .. code-block:: Python</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">            zs = [t + random.randn()*4 for t in range (40)]</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">            (mu, cov, _, _) = kalman.batch_filter(zs)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">            (x, P, K) = rts_smoother(mu, cov, fk.F, fk.Q)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="c1"># pylint: disable=too-many-locals, too-many-arguments</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ps</span><span class="p">):</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Xs and Ps must have the same length&quot;</span><span class="p">)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="n">n</span><span class="p">,</span> <span class="n">dim_x</span> <span class="o">=</span> <span class="n">Xs</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="k">elif</span> <span class="n">isscalar</span><span class="p">(</span><span class="n">dts</span><span class="p">):</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="n">dts</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="k">if</span> <span class="n">Qs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="n">Qs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="k">if</span> <span class="n">UT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="n">UT</span> <span class="o">=</span> <span class="n">unscented_transform</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="c1"># smoother gain</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">Ks</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">))</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">num_sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">xs</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">Xs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">Ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">sigmas_f</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_sigmas</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">))</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>            <span class="c1"># create sigma points from state estimate, pass through state func</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="n">sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span><span class="o">.</span><span class="n">sigma_points</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sigmas</span><span class="p">):</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                <span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">(</span><span class="n">sigmas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dts</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="n">xb</span><span class="p">,</span> <span class="n">Pb</span> <span class="o">=</span> <span class="n">UT</span><span class="p">(</span><span class="n">sigmas_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">)</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>            <span class="c1"># compute cross variance</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="n">Pxb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sigmas</span><span class="p">):</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xb</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">sigmas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Xs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                <span class="n">Pxb</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">outer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>            <span class="c1"># compute gain</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>            <span class="n">K</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">Pxb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Pb</span><span class="p">))</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>            <span class="c1"># update the smoothed estimates</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>            <span class="n">xs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xb</span><span class="p">))</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="n">ps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pb</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="n">Ks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">Ks</span><span class="p">)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">        log-likelihood of the last measurement.</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span> <span class="o">=</span> <span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        Computed from the log-likelihood. The log-likelihood can be very</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">        small,  meaning a large negative value such as -28000. Taking the</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        exp() of that results in 0.0, which can break typical algorithms</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">        which multiply by this value, so by default we always return a</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        number &gt;= sys.float_info.min.</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mahalanobis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        Mahalanobis distance of measurement. E.g. 3 means measurement</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">        was 3 standard deviations away from the predicted value.</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        -------</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        mahalanobis : float</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SI</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="p">[</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                <span class="s2">&quot;UnscentedKalmanFilter object&quot;</span><span class="p">,</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;x_prior&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span><span class="p">),</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;P_prior&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span><span class="p">),</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">),</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">),</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">),</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">),</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;log-likelihood&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">),</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;likelihood&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">),</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;mahalanobis&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mahalanobis</span><span class="p">),</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;sigmas_f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">),</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span><span class="p">),</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wm&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">),</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">),</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;residual_x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">),</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;residual_z&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">),</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;msqrt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msqrt</span><span class="p">),</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;hx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hx</span><span class="p">),</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;fx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">),</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;x_mean&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span><span class="p">),</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;z_mean&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_mean</span><span class="p">),</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>            <span class="p">]</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.likelihood" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">likelihood</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.likelihood" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Computed from the log-likelihood. The log-likelihood can be very
small,  meaning a large negative value such as -28000. Taking the
exp() of that results in 0.0, which can break typical algorithms
which multiply by this value, so by default we always return a
number &gt;= sys.float_info.min.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.log_likelihood" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">log_likelihood</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.log_likelihood" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>log-likelihood of the last measurement.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.mahalanobis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mahalanobis</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.mahalanobis" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>"
Mahalanobis distance of measurement. E.g. 3 means measurement
was 3 standard deviations away from the predicted value.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>mahalanobis</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">hx</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">sqrt_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_mean_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_mean_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state_add</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a Kalman filter. You are responsible for setting the
various state variables to reasonable values; the defaults below will
not give you a functional filter.</p>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">dim_x</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">dim_z</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="n">hx</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">fx</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">points</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">sqrt_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">x_mean_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">z_mean_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">residual_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">residual_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">state_add</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="p">):</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    Create a Kalman filter. You are responsible for setting the</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    various state variables to reasonable values; the defaults below will</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    not give you a functional filter.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="c1"># pylint: disable=too-many-arguments</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">dim_x</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="n">dim_z</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span> <span class="o">=</span> <span class="n">dim_x</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span> <span class="o">=</span> <span class="n">dim_z</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span> <span class="o">=</span> <span class="n">points</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="n">dt</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">num_sigmas</span><span class="p">()</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">hx</span> <span class="o">=</span> <span class="n">hx</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span> <span class="o">=</span> <span class="n">x_mean_fn</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">z_mean</span> <span class="o">=</span> <span class="n">z_mean_fn</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="c1"># Only computed only if requested via property</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">if</span> <span class="n">sqrt_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msqrt</span> <span class="o">=</span> <span class="n">cholesky</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">msqrt</span> <span class="o">=</span> <span class="n">sqrt_fn</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="c1"># weights for the means and covariances.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="n">points</span><span class="o">.</span><span class="n">Wc</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="k">if</span> <span class="n">residual_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span> <span class="o">=</span> <span class="n">residual_x</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">if</span> <span class="n">residual_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span> <span class="o">=</span> <span class="n">residual_z</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">if</span> <span class="n">state_add</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state_add</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state_add</span> <span class="o">=</span> <span class="n">state_add</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="c1"># sigma points transformed through f(x) and h(x)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="c1"># variables for efficiency so we don&#39;t recreate every update</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">))</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">))</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># Kalman gain</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># residual</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim_z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># measurement</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_z</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># system uncertainty</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">SI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_z</span><span class="p">,</span> <span class="n">dim_z</span><span class="p">))</span>  <span class="c1"># inverse system uncertainty</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="c1"># these will always be a copy of x,P after predict() is called</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="c1"># these will always be a copy of x,P after update() is called</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.batch_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">batch_filter</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saver</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.batch_filter" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Performs the UKF filter over the list of measurement in <code>zs</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>zs</code>
            </td>
            <td>
                  <code><span title="list">list</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of measurements at each time step <code>self._dt</code> Missing
measurements must be represented by 'None'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Rs</code>
            </td>
            <td>
                  <code>(None, <span title="numpy.array">array</span> or <span title="list">list</span> - <span title="like">like</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional list of values to use for the measurement error
covariance R.</p>
<p>If Rs is None then self.R is used for all epochs.</p>
<p>If it is a list of matrices or a 3D array where
len(Rs) == len(zs), then it is treated as a list of R values, one
per epoch. This allows you to have varying R per epoch.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dts</code>
            </td>
            <td>
                  <code>(None, <span title="scalar">scalar</span> or <span title="list">list</span> - <span title="like">like</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional value or list of delta time to be passed into predict.</p>
<p>If dtss is None then self.dt is used for all epochs.</p>
<p>If it is a list where len(dts) == len(zs), then it is treated as a
list of dt values, one per epoch. This allows you to have varying
epoch durations.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>UT</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="sigmas">sigmas</span>, <span title="Wm">Wm</span>, <span title="Wc">Wc</span>, <span title="noise_cov">noise_cov</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional function to compute the unscented transform for the sigma
points passed through hx. Typically the default function will
work - you can use x_mean_fn and z_mean_fn to alter the behavior
of the unscented transform.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>saver</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Saver (bayesian_filters.common.Saver)" href="../../api/common/#bayesian_filters.common.helpers.Saver">Saver</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bayesian_filters.common.Saver object. If provided, saver.save() will be
called after every epoch</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>means</code></td>            <td>
                  <code><span title="ndarray">ndarray</span>((<span title="n">n</span>, <span title="dim_x">dim_x</span>, 1))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of the state for each time step after the update. Each entry
is an np.array. In other words <code>means[k,:]</code> is the state at step
<code>k</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>covariance</code></td>            <td>
                  <code><span title="ndarray">ndarray</span>((<span title="n">n</span>, <span title="dim_x">dim_x</span>, <span title="dim_x">dim_x</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of the covariances for each time step after the update.
In other words <code>covariance[k,:,:]</code> is the covariance at step <code>k</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>.. code-block:: Python</p>
<div class="highlight"><pre><span></span><code># this example demonstrates tracking a measurement where the time
# between measurement varies, as stored in dts The output is then smoothed
# with an RTS smoother.

zs = [t + random.randn()*4 for t in range (40)]

(mu, cov, _, _) = ukf.batch_filter(zs, dts=dts)
(xs, Ps, Ks) = ukf.rts_smoother(mu, cov)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="k">def</span><span class="w"> </span><span class="nf">batch_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saver</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    Performs the UKF filter over the list of measurement in `zs`.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    zs : list-like</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        list of measurements at each time step `self._dt` Missing</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        measurements must be represented by &#39;None&#39;.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    Rs : None, np.array or list-like, default=None</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        optional list of values to use for the measurement error</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        covariance R.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        If Rs is None then self.R is used for all epochs.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        If it is a list of matrices or a 3D array where</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        len(Rs) == len(zs), then it is treated as a list of R values, one</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">        per epoch. This allows you to have varying R per epoch.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    dts : None, scalar or list-like, default=None</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">        optional value or list of delta time to be passed into predict.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        If dtss is None then self.dt is used for all epochs.</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">        If it is a list where len(dts) == len(zs), then it is treated as a</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">        list of dt values, one per epoch. This allows you to have varying</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        epoch durations.</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">    UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a><span class="sd">        Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        of the unscented transform.</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="sd">    saver : bayesian_filters.common.Saver, optional</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a><span class="sd">        bayesian_filters.common.Saver object. If provided, saver.save() will be</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        called after every epoch</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    -------</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    means: ndarray((n,dim_x,1))</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        array of the state for each time step after the update. Each entry</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">        is an np.array. In other words `means[k,:]` is the state at step</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">        `k`.</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">    covariance: ndarray((n,dim_x,dim_x))</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">        array of the covariances for each time step after the update.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        In other words `covariance[k,:,:]` is the covariance at step `k`.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    --------</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    .. code-block:: Python</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        # this example demonstrates tracking a measurement where the time</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        # between measurement varies, as stored in dts The output is then smoothed</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        # with an RTS smoother.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        zs = [t + random.randn()*4 for t in range (40)]</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        (mu, cov, _, _) = ukf.batch_filter(zs, dts=dts)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        (xs, Ps, Ks) = ukf.rts_smoother(mu, cov)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="c1"># pylint: disable=too-many-arguments</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">zs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;zs must be list-like&quot;</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">isscalar</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;zs must be a list of scalars or 1D, 1 element arrays&quot;</span><span class="p">)</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">:</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;each element in zs must be a 1D array of length </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">))</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="n">z_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="k">if</span> <span class="n">Rs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="n">Rs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_n</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">]</span> <span class="o">*</span> <span class="n">z_n</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="c1"># mean estimates from Kalman Filter</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="n">means</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">z_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">))</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="n">means</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">z_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>    <span class="c1"># state covariances from Kalman Filter</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">covariances</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">z_n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_x</span><span class="p">))</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">Rs</span><span class="p">,</span> <span class="n">dts</span><span class="p">)):</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="n">UT</span><span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="n">UT</span><span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="n">covariances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="k">if</span> <span class="n">saver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">covariances</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.compute_process_sigmas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_process_sigmas</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.compute_process_sigmas" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>computes the values of sigmas_f. Normally a user would not call
this, but it is useful if you need to call update more than once
between calls to predict (to update for multiple simultaneous
measurements), so the sigmas correctly reflect the updated state
x, P.</p>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_process_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">):</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    computes the values of sigmas_f. Normally a user would not call</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    this, but it is useful if you need to call update more than once</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    between calls to predict (to update for multiple simultaneous</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    measurements), so the sigmas correctly reflect the updated state</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    x, P.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="k">if</span> <span class="n">fx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">fx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fx</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="c1"># calculate sigma points for given mean and covariance</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="n">sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span><span class="o">.</span><span class="n">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sigmas</span><span class="p">):</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fx</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.cross_variance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cross_variance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sigmas_f</span><span class="p">,</span> <span class="n">sigmas_h</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.cross_variance" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute cross variance of the state <code>x</code> and measurement <code>z</code>.</p>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="k">def</span><span class="w"> </span><span class="nf">cross_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">sigmas_f</span><span class="p">,</span> <span class="n">sigmas_h</span><span class="p">):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">    Compute cross variance of the state `x` and measurement `z`.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="n">Pxz</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">sigmas_f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigmas_h</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">sigmas_f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">(</span><span class="n">sigmas_h</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="n">Pxz</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">outer</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">return</span> <span class="n">Pxz</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.predict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Performs the predict step of the UKF. On return, self.x and
self.P contain the predicted state (x) and covariance (P). '</p>
<p>Important: this MUST be called before update() is called for the first
time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code><span title="double">double</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If specified, the time step to be used for this prediction.
self._dt is used if this is not provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fx</code>
            </td>
            <td>
                  <code>callable f(x, dt, **fx_args)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State transition function. If not provided, the default
function passed in during construction will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>UT</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="sigmas">sigmas</span>, <span title="Wm">Wm</span>, <span title="Wc">Wc</span>, <span title="noise_cov">noise_cov</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional function to compute the unscented transform for the sigma
points passed through hx. Typically the default function will
work - you can use x_mean_fn and z_mean_fn to alter the behavior
of the unscented transform.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**fx_args</code>
            </td>
            <td>
                  <code>keyword arguments</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional keyword arguments to be passed into f(x).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">):</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    Performs the predict step of the UKF. On return, self.x and</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">    self.P contain the predicted state (x) and covariance (P). &#39;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">    Important: this MUST be called before update() is called for the first</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    time.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    dt : double, optional</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        If specified, the time step to be used for this prediction.</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        self._dt is used if this is not provided.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    fx : callable f(x, dt, **fx_args), optional</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        State transition function. If not provided, the default</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        function passed in during construction will be used.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        of the unscented transform.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">    **fx_args : keyword arguments</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        optional keyword arguments to be passed into f(x).</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">if</span> <span class="n">UT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">UT</span> <span class="o">=</span> <span class="n">unscented_transform</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="c1"># calculate sigma points for given mean and covariance</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compute_process_sigmas</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="o">**</span><span class="n">fx_args</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="c1"># and pass sigmas through the unscented transform to compute prior</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">UT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="c1"># update sigma points to reflect the new variance of the points</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span><span class="o">.</span><span class="n">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="c1"># save prior</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.rts_smoother" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rts_smoother</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span> <span class="n">Ps</span><span class="p">,</span> <span class="n">Qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.rts_smoother" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Runs the Rauch-Tung-Striebel Kalman smoother on a set of
means and covariances computed by the UKF. The usual input
would come from the output of <code>batch_filter()</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>Xs</code>
            </td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of the means (state variable x) of the output of a Kalman
filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Ps</code>
            </td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of the covariances of the output of a kalman filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Qs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Process noise of the Kalman filter at each time step. Optional,
if not provided the filter's self.Q will be used</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code>optional, float or array-like of float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, specifies the time step of each step of the filter.
If float, then the same time step is used for all steps. If
an array, then each element k contains the time  at step k.
Units are seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>UT</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="sigmas">sigmas</span>, <span title="Wm">Wm</span>, <span title="Wc">Wc</span>, <span title="noise_cov">noise_cov</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional function to compute the unscented transform for the sigma
points passed through hx. Typically the default function will
work - you can use x_mean_fn and z_mean_fn to alter the behavior
of the unscented transform.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>x</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>smoothed means</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>P</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>smoothed state covariances</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>K</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>smoother gain at each step</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>.. code-block:: Python</p>
<div class="highlight"><pre><span></span><code>zs = [t + random.randn()*4 for t in range (40)]

(mu, cov, _, _) = kalman.batch_filter(zs)
(x, P, K) = rts_smoother(mu, cov, fk.F, fk.Q)
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="k">def</span><span class="w"> </span><span class="nf">rts_smoother</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xs</span><span class="p">,</span> <span class="n">Ps</span><span class="p">,</span> <span class="n">Qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    Runs the Rauch-Tung-Striebel Kalman smoother on a set of</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    means and covariances computed by the UKF. The usual input</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    would come from the output of `batch_filter()`.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    Xs : numpy.array</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        array of the means (state variable x) of the output of a Kalman</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">        filter.</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    Ps : numpy.array</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">        array of the covariances of the output of a kalman filter.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">    Qs: list-like collection of numpy.array, optional</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">        Process noise of the Kalman filter at each time step. Optional,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">        if not provided the filter&#39;s self.Q will be used</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">    dt : optional, float or array-like of float</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        If provided, specifies the time step of each step of the filter.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        If float, then the same time step is used for all steps. If</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        an array, then each element k contains the time  at step k.</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">        Units are seconds.</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">        points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">        work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        of the unscented transform.</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">    -------</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    x : numpy.ndarray</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">        smoothed means</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    P : numpy.ndarray</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">        smoothed state covariances</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">    K : numpy.ndarray</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        smoother gain at each step</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    --------</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    .. code-block:: Python</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        zs = [t + random.randn()*4 for t in range (40)]</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        (mu, cov, _, _) = kalman.batch_filter(zs)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        (x, P, K) = rts_smoother(mu, cov, fk.F, fk.Q)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>    <span class="c1"># pylint: disable=too-many-locals, too-many-arguments</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ps</span><span class="p">):</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Xs and Ps must have the same length&quot;</span><span class="p">)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="n">n</span><span class="p">,</span> <span class="n">dim_x</span> <span class="o">=</span> <span class="n">Xs</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="k">elif</span> <span class="n">isscalar</span><span class="p">(</span><span class="n">dts</span><span class="p">):</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="n">dts</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="k">if</span> <span class="n">Qs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">Qs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="k">if</span> <span class="n">UT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">UT</span> <span class="o">=</span> <span class="n">unscented_transform</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="c1"># smoother gain</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="n">Ks</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">))</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>    <span class="n">num_sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_sigmas</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="n">xs</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">Xs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">Ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>    <span class="n">sigmas_f</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">num_sigmas</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">))</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="c1"># create sigma points from state estimate, pass through state func</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="n">sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_fn</span><span class="o">.</span><span class="n">sigma_points</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sigmas</span><span class="p">):</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">(</span><span class="n">sigmas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dts</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="n">xb</span><span class="p">,</span> <span class="n">Pb</span> <span class="o">=</span> <span class="n">UT</span><span class="p">(</span><span class="n">sigmas_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">)</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="c1"># compute cross variance</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="n">Pxb</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sigmas</span><span class="p">):</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">sigmas_f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xb</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">sigmas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Xs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="n">Pxb</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">outer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="c1"># compute gain</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">Pxb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Pb</span><span class="p">))</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="c1"># update the smoothed estimates</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">xs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_x</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xb</span><span class="p">))</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">ps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pb</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="n">Ks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">Ks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.UKF.UnscentedKalmanFilter.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">hx_args</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.UKF.UnscentedKalmanFilter.update" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Update the UKF with the given measurements. On return,
self.x and self.P contain the new mean and covariance of the filter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code>numpy.array of shape (dim_z)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>measurement vector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>R</code>
            </td>
            <td>
                  <code><span title="numpy.array">array</span>((<span title="dim_z">dim_z</span>, <span title="dim_z">dim_z</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Measurement noise. If provided, overrides self.R for
this function call.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>UT</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="sigmas">sigmas</span>, <span title="Wm">Wm</span>, <span title="Wc">Wc</span>, <span title="noise_cov">noise_cov</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional function to compute the unscented transform for the sigma
points passed through hx. Typically the default function will
work - you can use x_mean_fn and z_mean_fn to alter the behavior
of the unscented transform.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hx</code>
            </td>
            <td>
                  <code>callable h(x, **hx_args)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Measurement function. If not provided, the default
function passed in during construction will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**hx_args</code>
            </td>
            <td>
                  <code>keyword argument</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>arguments to be passed into h(x) after x -&gt; h(x, **hx_args)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/UKF.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">UT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">hx_args</span><span class="p">):</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    Update the UKF with the given measurements. On return,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    self.x and self.P contain the new mean and covariance of the filter.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">    z : numpy.array of shape (dim_z)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        measurement vector</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    R : numpy.array((dim_z, dim_z)), optional</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        Measurement noise. If provided, overrides self.R for</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        this function call.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    UT : function(sigmas, Wm, Wc, noise_cov), optional</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        Optional function to compute the unscented transform for the sigma</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        points passed through hx. Typically the default function will</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        work - you can use x_mean_fn and z_mean_fn to alter the behavior</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        of the unscented transform.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    hx : callable h(x, **hx_args), optional</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        Measurement function. If not provided, the default</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        function passed in during construction will be used.</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    **hx_args : keyword argument</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        arguments to be passed into h(x) after x -&gt; h(x, **hx_args)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">P_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">return</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="k">if</span> <span class="n">hx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="n">hx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hx</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="k">if</span> <span class="n">UT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="n">UT</span> <span class="o">=</span> <span class="n">unscented_transform</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="k">elif</span> <span class="n">isscalar</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_z</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="c1"># pass prior sigmas through h(x) to get measurement sigmas</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="c1"># the shape of sigmas_h will vary if the shape of z varies, so</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="c1"># recreate each time</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">sigmas_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">:</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="n">sigmas_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hx</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">hx_args</span><span class="p">))</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">sigmas_h</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="c1"># mean and covariance of prediction passed through unscented transform</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">UT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">SI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="c1"># compute cross variance of the state and the measurements</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="n">Pxz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_variance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">zp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_h</span><span class="p">)</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">Pxz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SI</span><span class="p">)</span>  <span class="c1"># Kalman gain</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_z</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">zp</span><span class="p">)</span>  <span class="c1"># residual</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="c1"># update Gaussian state estimate (x, P)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="c1"># save measurement and posterior state</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">x_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">P_post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="c1"># set to None to force recompute</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_log_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_likelihood</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_mahalanobis</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="merwe-scaled-sigma-points">Merwe Scaled Sigma Points<a class="headerlink" href="#merwe-scaled-sigma-points" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<h2 id="bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints" class="doc doc-heading">
            <code>MerweScaledSigmaPoints</code>


<a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Generates sigma points and weights according to Van der Merwe's
2004 dissertation[1] for the UnscentedKalmanFilter class.. It
parametizes the sigma points using alpha, beta, kappa terms, and
is the version seen in most publications.</p>
<p>Unless you know better, this should be your default choice.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimensionality of the state. 2n+1 weights will be generated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determins the spread of the sigma points around the mean.
Usually a small positive value (1e-3) according to [3].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incorporates prior knowledge of the distribution of the mean. For
Gaussian x beta=2 is optimal, according to [3].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sqrt_method</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="ndarray">ndarray</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines how we compute the square root of a matrix, which has
no unique answer. Cholesky is the default choice due to its
speed. Typically your alternative choice will be
scipy.linalg.sqrtm. Different choices affect how the sigma points
are arranged relative to the eigenvectors of the covariance matrix.
Usually this will not matter to you; if so the default cholesky()
yields maximal performance. As of van der Merwe's dissertation of
2004 [6] this was not a well reseached area so I have no advice
to give you.</p>
<p>If your method returns a triangular matrix it must be upper
triangular. Do not use numpy.linalg.cholesky - for historical
reasons it returns a lower triangular matrix. The SciPy version
does the right thing.</p>
              </div>
            </td>
            <td>
                  <code>scipy.linalg.cholesky</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subtract</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="x">x</span>, <span title="y">y</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that computes the difference between x and y.
You will have to supply this if your state variable cannot support
subtraction, such as angles (359-1 degreees is 2, not 358). x and y
are state vectors, not scalars.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.Wm">Wm</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weight for each sigma point for the mean</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.Wc">Wc</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weight for each sigma point for the covariance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>See my book Kalman and Bayesian Filters in Python
https://github.com/rlabbe/Kalman-and-Bayesian-Filters-in-Python</p>


<details class="references" open>
  <summary>References</summary>
  <p>.. [1] R. Van der Merwe "Sigma-Point Kalman Filters for Probabilitic
       Inference in Dynamic State-Space Models" (Doctoral dissertation)</p>
</details>







              <details class="quote">
                <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">MerweScaledSigmaPoints</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Generates sigma points and weights according to Van der Merwe&#39;s</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    2004 dissertation[1] for the UnscentedKalmanFilter class.. It</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    parametizes the sigma points using alpha, beta, kappa terms, and</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    is the version seen in most publications.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    Unless you know better, this should be your default choice.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    n : int</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        Dimensionality of the state. 2n+1 weights will be generated.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    alpha : float</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        Determins the spread of the sigma points around the mean.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        Usually a small positive value (1e-3) according to [3].</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    beta : float</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        Incorporates prior knowledge of the distribution of the mean. For</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Gaussian x beta=2 is optimal, according to [3].</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    sqrt_method : function(ndarray), default=scipy.linalg.cholesky</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        Defines how we compute the square root of a matrix, which has</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        no unique answer. Cholesky is the default choice due to its</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        speed. Typically your alternative choice will be</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        scipy.linalg.sqrtm. Different choices affect how the sigma points</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        are arranged relative to the eigenvectors of the covariance matrix.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Usually this will not matter to you; if so the default cholesky()</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        yields maximal performance. As of van der Merwe&#39;s dissertation of</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        2004 [6] this was not a well reseached area so I have no advice</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        to give you.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        If your method returns a triangular matrix it must be upper</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        triangular. Do not use numpy.linalg.cholesky - for historical</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        reasons it returns a lower triangular matrix. The SciPy version</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        does the right thing.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    subtract : callable (x, y), optional</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        Function that computes the difference between x and y.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        You will have to supply this if your state variable cannot support</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        subtraction, such as angles (359-1 degreees is 2, not 358). x and y</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        are state vectors, not scalars.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Wm : np.array</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        weight for each sigma point for the mean</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Wc : np.array</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        weight for each sigma point for the covariance</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Examples</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    --------</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    See my book Kalman and Bayesian Filters in Python</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    https://github.com/rlabbe/Kalman-and-Bayesian-Filters-in-Python</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    References</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    .. [1] R. Van der Merwe &quot;Sigma-Point Kalman Filters for Probabilitic</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">           Inference in Dynamic State-Space Models&quot; (Doctoral dissertation)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">sqrt_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># pylint: disable=too-many-arguments</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">kappa</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="k">if</span> <span class="n">sqrt_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">=</span> <span class="n">cholesky</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">=</span> <span class="n">sqrt_method</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">subtract</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_weights</span><span class="p">()</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of sigma points for each variable in the state x&quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the sigma points for an unscented Kalman filter</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        given the mean (x) and covariance(P) of the filter.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Returns tuple of the sigma points and weights.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Works with both scalar and array inputs:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        sigma_points (5, 9, 2) # mean 5, covariance 9</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        x : An array-like object of the means of length n</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            Can be a scalar if 1D.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            examples: 1, [1,2], np.array([1,2])</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        P : scalar, or np.array</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">           Covariance of the filter. If scalar, is treated as eye(n)*P.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        -------</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        sigmas : np.array, of size (2n+1, n)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            Two dimensional array of sigma points. Each column contains all of</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            the sigmas for one dimension in the problem space.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            Ordered by Xi_0, Xi_{1..n}, Xi_{n+1..2n}</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;expected size(x) </span><span class="si">{}</span><span class="s2">, but size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">lambda_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">lambda_</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">sigmas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">sigmas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="c1"># pylint: disable=bad-whitespace</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">sigmas</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">sigmas</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">return</span> <span class="n">sigmas</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the weights for the scaled unscented Kalman filter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">lambda_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">lambda_</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">lambda_</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="p">[</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="s2">&quot;MerweScaledSigmaPoints object&quot;</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">),</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">),</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">),</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">),</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wm&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">),</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">),</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;subtract&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">),</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">),</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="p">]</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.num_sigmas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_sigmas</span><span class="p">()</span></code>

<a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.num_sigmas" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Number of sigma points for each variable in the state x</p>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">def</span><span class="w"> </span><span class="nf">num_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of sigma points for each variable in the state x&quot;&quot;&quot;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.sigma_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sigma_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.sigma_points.MerweScaledSigmaPoints.sigma_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Computes the sigma points for an unscented Kalman filter
given the mean (x) and covariance(P) of the filter.
Returns tuple of the sigma points and weights.</p>
<p>Works with both scalar and array inputs:
sigma_points (5, 9, 2) # mean 5, covariance 9
sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code>An array-like object of the means of length n</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Can be a scalar if 1D.
examples: 1, [1,2], np.array([1,2])</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>P</code>
            </td>
            <td>
                  <code>scalar, or np.array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Covariance of the filter. If scalar, is treated as eye(n)*P.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sigmas</code></td>            <td>
                  <code>np.array, of size (2n+1, n)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two dimensional array of sigma points. Each column contains all of
the sigmas for one dimension in the problem space.</p>
<p>Ordered by Xi_0, Xi_{1..n}, Xi_{n+1..2n}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the sigma points for an unscented Kalman filter</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    given the mean (x) and covariance(P) of the filter.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Returns tuple of the sigma points and weights.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    Works with both scalar and array inputs:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    sigma_points (5, 9, 2) # mean 5, covariance 9</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    x : An array-like object of the means of length n</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        Can be a scalar if 1D.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        examples: 1, [1,2], np.array([1,2])</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    P : scalar, or np.array</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">       Covariance of the filter. If scalar, is treated as eye(n)*P.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    -------</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    sigmas : np.array, of size (2n+1, n)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Two dimensional array of sigma points. Each column contains all of</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        the sigmas for one dimension in the problem space.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Ordered by Xi_0, Xi_{1..n}, Xi_{n+1..2n}</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;expected size(x) </span><span class="si">{}</span><span class="s2">, but size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">lambda_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">lambda_</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">sigmas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">sigmas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="c1"># pylint: disable=bad-whitespace</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">sigmas</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">sigmas</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">return</span> <span class="n">sigmas</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="julier-sigma-points">Julier Sigma Points<a class="headerlink" href="#julier-sigma-points" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<h2 id="bayesian_filters.kalman.sigma_points.JulierSigmaPoints" class="doc doc-heading">
            <code>JulierSigmaPoints</code>


<a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Generates sigma points and weights according to Simon J. Julier
and Jeffery K. Uhlmann's original paper[1]. It parametizes the sigma
points using kappa.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimensionality of the state. 2n+1 weights will be generated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sqrt_method</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="ndarray">ndarray</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines how we compute the square root of a matrix, which has
no unique answer. Cholesky is the default choice due to its
speed. Typically your alternative choice will be
scipy.linalg.sqrtm. Different choices affect how the sigma points
are arranged relative to the eigenvectors of the covariance matrix.
Usually this will not matter to you; if so the default cholesky()
yields maximal performance. As of van der Merwe's dissertation of
2004 [6] this was not a well reseached area so I have no advice
to give you.</p>
<p>If your method returns a triangular matrix it must be upper
triangular. Do not use numpy.linalg.cholesky - for historical
reasons it returns a lower triangular matrix. The SciPy version
does the right thing.</p>
              </div>
            </td>
            <td>
                  <code>scipy.linalg.cholesky</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subtract</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="x">x</span>, <span title="y">y</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that computes the difference between x and y.
You will have to supply this if your state variable cannot support
subtraction, such as angles (359-1 degreees is 2, not 358). x and y</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.sigma_points.JulierSigmaPoints.Wm">Wm</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weight for each sigma point for the mean</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.sigma_points.JulierSigmaPoints.Wc">Wc</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weight for each sigma point for the covariance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="references" open>
  <summary>References</summary>
  <p>.. [1] Julier, Simon J.; Uhlmann, Jeffrey "A New Extension of the Kalman
    Filter to Nonlinear Systems". Proc. SPIE 3068, Signal Processing,
    Sensor Fusion, and Target Recognition VI, 182 (July 28, 1997)</p>
</details>







              <details class="quote">
                <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">class</span><span class="w"> </span><span class="nc">JulierSigmaPoints</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Generates sigma points and weights according to Simon J. Julier</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    and Jeffery K. Uhlmann&#39;s original paper[1]. It parametizes the sigma</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    points using kappa.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    n : int</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        Dimensionality of the state. 2n+1 weights will be generated.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    sqrt_method : function(ndarray), default=scipy.linalg.cholesky</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        Defines how we compute the square root of a matrix, which has</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        no unique answer. Cholesky is the default choice due to its</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        speed. Typically your alternative choice will be</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        scipy.linalg.sqrtm. Different choices affect how the sigma points</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        are arranged relative to the eigenvectors of the covariance matrix.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        Usually this will not matter to you; if so the default cholesky()</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        yields maximal performance. As of van der Merwe&#39;s dissertation of</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        2004 [6] this was not a well reseached area so I have no advice</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        to give you.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        If your method returns a triangular matrix it must be upper</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        triangular. Do not use numpy.linalg.cholesky - for historical</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        reasons it returns a lower triangular matrix. The SciPy version</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        does the right thing.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    subtract : callable (x, y), optional</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Function that computes the difference between x and y.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        You will have to supply this if your state variable cannot support</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        subtraction, such as angles (359-1 degreees is 2, not 358). x and y</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Wm : np.array</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        weight for each sigma point for the mean</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    Wc : np.array</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        weight for each sigma point for the covariance</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    References</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    .. [1] Julier, Simon J.; Uhlmann, Jeffrey &quot;A New Extension of the Kalman</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        Filter to Nonlinear Systems&quot;. Proc. SPIE 3068, Signal Processing,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        Sensor Fusion, and Target Recognition VI, 182 (July 28, 1997)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sqrt_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">kappa</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">if</span> <span class="n">sqrt_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">=</span> <span class="n">cholesky</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">=</span> <span class="n">sqrt_method</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">if</span> <span class="n">subtract</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_weights</span><span class="p">()</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of sigma points for each variable in the state x&quot;&quot;&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot; Computes the sigma points for an unscented Kalman filter</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        given the mean (x) and covariance(P) of the filter.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">        kappa is an arbitrary constant. Returns sigma points.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        Works with both scalar and array inputs:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        sigma_points (5, 9, 2) # mean 5, covariance 9</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        x : array-like object of the means of length n</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">            Can be a scalar if 1D.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">            examples: 1, [1,2], np.array([1,2])</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        P : scalar, or np.array</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">           Covariance of the filter. If scalar, is treated as eye(n)*P.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        kappa : float</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">            Scaling factor.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        -------</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        sigmas : np.array, of size (2n+1, n)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            2D array of sigma points :math:`\chi`. Each column contains all of</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">            the sigmas for one dimension in the problem space. They</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">            are ordered as:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            .. math::</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                :nowrap:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">                \begin{eqnarray}</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">                  \chi[0]    = &amp;x \\</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">                  \chi[1..n] = &amp;x + [\sqrt{(n+\kappa)P}]_k \\</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">                  \chi[n+1..2n] = &amp;x - [\sqrt{(n+\kappa)P}]_k</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                \end{eqnarray}</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;expected size(x) </span><span class="si">{}</span><span class="s2">, but size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># dimension of problem</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">sigmas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="c1"># implements U&#39;*U = (n+kappa)*P. Returns lower triangular matrix.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="c1"># Take transpose so we can access with U[i]</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">sigmas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="c1"># pylint: disable=bad-whitespace</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="n">sigmas</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="n">sigmas</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">return</span> <span class="n">sigmas</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the weights for the unscented Kalman filter. In this</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        formulation the weights for the mean and covariance are the same.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span><span class="p">))</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="p">[</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                <span class="s2">&quot;JulierSigmaPoints object&quot;</span><span class="p">,</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">),</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">),</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wm&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">),</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">),</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;subtract&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">),</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">),</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="p">]</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.sigma_points.JulierSigmaPoints.num_sigmas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_sigmas</span><span class="p">()</span></code>

<a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints.num_sigmas" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Number of sigma points for each variable in the state x</p>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="k">def</span><span class="w"> </span><span class="nf">num_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of sigma points for each variable in the state x&quot;&quot;&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.sigma_points.JulierSigmaPoints.sigma_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sigma_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.sigma_points.JulierSigmaPoints.sigma_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Computes the sigma points for an unscented Kalman filter
given the mean (x) and covariance(P) of the filter.
kappa is an arbitrary constant. Returns sigma points.</p>
<p>Works with both scalar and array inputs:
sigma_points (5, 9, 2) # mean 5, covariance 9
sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code>array-like object of the means of length n</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Can be a scalar if 1D.
examples: 1, [1,2], np.array([1,2])</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>P</code>
            </td>
            <td>
                  <code>scalar, or np.array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Covariance of the filter. If scalar, is treated as eye(n)*P.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scaling factor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sigmas</code></td>            <td>
                  <code>np.array, of size (2n+1, n)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of sigma points :math:<code>\chi</code>. Each column contains all of
the sigmas for one dimension in the problem space. They
are ordered as:</p>
<p>.. math::
    :nowrap:</p>
<div class="highlight"><pre><span></span><code>\begin{eqnarray}
  \chi[0]    = &amp;x \\
  \chi[1..n] = &amp;x + [\sqrt{(n+\kappa)P}]_k \\
  \chi[n+1..2n] = &amp;x - [\sqrt{(n+\kappa)P}]_k
\end{eqnarray}
</code></pre></div>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="k">def</span><span class="w"> </span><span class="nf">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot; Computes the sigma points for an unscented Kalman filter</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    given the mean (x) and covariance(P) of the filter.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    kappa is an arbitrary constant. Returns sigma points.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    Works with both scalar and array inputs:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    sigma_points (5, 9, 2) # mean 5, covariance 9</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    x : array-like object of the means of length n</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        Can be a scalar if 1D.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        examples: 1, [1,2], np.array([1,2])</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    P : scalar, or np.array</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">       Covariance of the filter. If scalar, is treated as eye(n)*P.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    kappa : float</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        Scaling factor.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    -------</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    sigmas : np.array, of size (2n+1, n)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        2D array of sigma points :math:`\chi`. Each column contains all of</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        the sigmas for one dimension in the problem space. They</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        are ordered as:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        .. math::</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">            :nowrap:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            \begin{eqnarray}</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">              \chi[0]    = &amp;x \\</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">              \chi[1..n] = &amp;x + [\sqrt{(n+\kappa)P}]_k \\</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">              \chi[n+1..2n] = &amp;x - [\sqrt{(n+\kappa)P}]_k</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">            \end{eqnarray}</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;expected size(x) </span><span class="si">{}</span><span class="s2">, but size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># dimension of problem</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="n">sigmas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="c1"># implements U&#39;*U = (n+kappa)*P. Returns lower triangular matrix.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="c1"># Take transpose so we can access with U[i]</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="n">sigmas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="c1"># pylint: disable=bad-whitespace</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">sigmas</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">sigmas</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="k">return</span> <span class="n">sigmas</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="simplex-sigma-points">Simplex Sigma Points<a class="headerlink" href="#simplex-sigma-points" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-class">



<h2 id="bayesian_filters.kalman.sigma_points.SimplexSigmaPoints" class="doc doc-heading">
            <code>SimplexSigmaPoints</code>


<a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>


        <p>Generates sigma points and weights according to the simplex
method presented in [1].</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dimensionality of the state. n+1 weights will be generated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sqrt_method</code>
            </td>
            <td>
                  <code><span title="function">function</span>(<span title="ndarray">ndarray</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defines how we compute the square root of a matrix, which has
no unique answer. Cholesky is the default choice due to its
speed. Typically your alternative choice will be
scipy.linalg.sqrtm</p>
<p>If your method returns a triangular matrix it must be upper
triangular. Do not use numpy.linalg.cholesky - for historical
reasons it returns a lower triangular matrix. The SciPy version
does the right thing.</p>
              </div>
            </td>
            <td>
                  <code>scipy.linalg.cholesky</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subtract</code>
            </td>
            <td>
                  <code><span title="callable">callable</span>(<span title="x">x</span>, <span title="y">y</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function that computes the difference between x and y.
You will have to supply this if your state variable cannot support
subtraction, such as angles (359-1 degreees is 2, not 358). x and y
are state vectors, not scalars.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.Wm">Wm</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weight for each sigma point for the mean</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.Wc">Wc</span></code></td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weight for each sigma point for the covariance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="references" open>
  <summary>References</summary>
  <p>.. [1] Phillippe Moireau and Dominique Chapelle "Reduced-Order
       Unscented Kalman Filtering with Application to Parameter
       Identification in Large-Dimensional Systems"
       DOI: 10.1051/cocv/2010006</p>
</details>







              <details class="quote">
                <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="k">class</span><span class="w"> </span><span class="nc">SimplexSigmaPoints</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    Generates sigma points and weights according to the simplex</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">    method presented in [1].</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">    n : int</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        Dimensionality of the state. n+1 weights will be generated.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    sqrt_method : function(ndarray), default=scipy.linalg.cholesky</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        Defines how we compute the square root of a matrix, which has</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        no unique answer. Cholesky is the default choice due to its</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        speed. Typically your alternative choice will be</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        scipy.linalg.sqrtm</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        If your method returns a triangular matrix it must be upper</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">        triangular. Do not use numpy.linalg.cholesky - for historical</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        reasons it returns a lower triangular matrix. The SciPy version</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        does the right thing.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    subtract : callable (x, y), optional</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        Function that computes the difference between x and y.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        You will have to supply this if your state variable cannot support</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        subtraction, such as angles (359-1 degreees is 2, not 358). x and y</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        are state vectors, not scalars.</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    Wm : np.array</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        weight for each sigma point for the mean</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    Wc : np.array</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        weight for each sigma point for the covariance</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    References</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    .. [1] Phillippe Moireau and Dominique Chapelle &quot;Reduced-Order</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">           Unscented Kalman Filtering with Application to Parameter</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">           Identification in Large-Dimensional Systems&quot;</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">           DOI: 10.1051/cocv/2010006</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sqrt_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subtract</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="k">if</span> <span class="n">sqrt_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">=</span> <span class="n">cholesky</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">=</span> <span class="n">sqrt_method</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="k">if</span> <span class="n">subtract</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_weights</span><span class="p">()</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of sigma points for each variable in the state x&quot;&quot;&quot;</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        Computes the implex sigma points for an unscented Kalman filter</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        given the mean (x) and covariance(P) of the filter.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        Returns tuple of the sigma points and weights.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        Works with both scalar and array inputs:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        sigma_points (5, 9, 2) # mean 5, covariance 9</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        Parameters</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        x : An array-like object of the means of length n</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">            Can be a scalar if 1D.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">            examples: 1, [1,2], np.array([1,2])</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        P : scalar, or np.array</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            Covariance of the filter. If scalar, is treated as eye(n)*P.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        -------</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        sigmas : np.array, of size (n+1, n)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">            Two dimensional array of sigma points. Each column contains all of</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">            the sigmas for one dimension in the problem space.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">            Ordered by Xi_0, Xi_{1..n}</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;expected size(x) </span><span class="si">{}</span><span class="s2">, but size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">lambda_</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">Istar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span><span class="p">)]])</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">Istar</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># pylint: disable=unsubscriptable-object</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">Istar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">Istar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Istar</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))],</span> <span class="n">row</span><span class="p">]</span>  <span class="c1"># pylint: disable=unsubscriptable-object</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">Istar</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">scaled_unitary</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">scaled_unitary</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">return</span> <span class="n">sigmas</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the weights for the scaled unscented Kalman filter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">c</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="p">[</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="s2">&quot;SimplexSigmaPoints object&quot;</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">),</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">),</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wm&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wm</span><span class="p">),</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;Wc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Wc</span><span class="p">),</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;subtract&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">),</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="n">pretty_str</span><span class="p">(</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">),</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="p">]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.num_sigmas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_sigmas</span><span class="p">()</span></code>

<a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.num_sigmas" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Number of sigma points for each variable in the state x</p>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="k">def</span><span class="w"> </span><span class="nf">num_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of sigma points for each variable in the state x&quot;&quot;&quot;</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.sigma_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sigma_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span></code>

<a href="#bayesian_filters.kalman.sigma_points.SimplexSigmaPoints.sigma_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Computes the implex sigma points for an unscented Kalman filter
given the mean (x) and covariance(P) of the filter.
Returns tuple of the sigma points and weights.</p>
<p>Works with both scalar and array inputs:
sigma_points (5, 9, 2) # mean 5, covariance 9
sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code>An array-like object of the means of length n</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Can be a scalar if 1D.
examples: 1, [1,2], np.array([1,2])</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>P</code>
            </td>
            <td>
                  <code>scalar, or np.array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Covariance of the filter. If scalar, is treated as eye(n)*P.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>sigmas</code></td>            <td>
                  <code>np.array, of size (n+1, n)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two dimensional array of sigma points. Each column contains all of
the sigmas for one dimension in the problem space.</p>
<p>Ordered by Xi_0, Xi_{1..n}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>bayesian_filters/kalman/sigma_points.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="k">def</span><span class="w"> </span><span class="nf">sigma_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    Computes the implex sigma points for an unscented Kalman filter</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    given the mean (x) and covariance(P) of the filter.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    Returns tuple of the sigma points and weights.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    Works with both scalar and array inputs:</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    sigma_points (5, 9, 2) # mean 5, covariance 9</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    sigma_points ([5, 2], 9*eye(2), 2) # means 5 and 2, covariance 9I</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    x : An array-like object of the means of length n</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Can be a scalar if 1D.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        examples: 1, [1,2], np.array([1,2])</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">    P : scalar, or np.array</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">        Covariance of the filter. If scalar, is treated as eye(n)*P.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    -------</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    sigmas : np.array, of size (n+1, n)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        Two dimensional array of sigma points. Each column contains all of</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        the sigmas for one dimension in the problem space.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        Ordered by Xi_0, Xi_{1..n}</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;expected size(x) </span><span class="si">{}</span><span class="s2">, but size is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">P</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">lambda_</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="n">Istar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span><span class="p">)]])</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">Istar</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># pylint: disable=unsubscriptable-object</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">Istar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">Istar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Istar</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))],</span> <span class="n">row</span><span class="p">]</span>  <span class="c1"># pylint: disable=unsubscriptable-object</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">Istar</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="n">scaled_unitary</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="n">sigmas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">scaled_unitary</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="k">return</span> <span class="n">sigmas</span><span class="o">.</span><span class="n">T</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2014-2025 Roger R. Labbe
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/GeorgePearse/filterpy" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/bayesian-filters/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>